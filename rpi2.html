<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raspberry Pi Stress Test Monitor</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #1e1e2e; color: #ffffff; text-align: center; }
        h1 { color: #00d4ff; }
        .container { width: 80%; margin: auto; }
        .device-card { background: #2a2a3b; padding: 20px; margin: 15px; border-radius: 10px; box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2); }
        .status { font-weight: bold; padding: 3px 8px; border-radius: 5px; }
        .good { background-color: #00ff00; color: black; }
        .warning { background-color: #ffcc00; color: black; }
        .critical { background-color: #ff0000; color: white; }
        .btn { background-color: #00d4ff; border: none; padding: 10px 20px; cursor: pointer; font-size: 16px; color: black; border-radius: 5px; }
        .btn:hover { background-color: #00a3cc; }
    </style>
</head>
<body>
    <h1>Raspberry Pi Stress Test & Network Monitor</h1>
    <div class="container">
        <div id="deviceGrid"></div>
    </div>

    <script>
        const devices = [
            { name: "Client-Pi1", ip: "172.18.18.20", peer: "172.18.18.21" } 
        ];

        function getStatusClass(value, warningThreshold, criticalThreshold) {
            if (value >= criticalThreshold) return "critical";
            if (value >= warningThreshold) return "warning";
            return "good";
        }

        function updateStats() {
            devices.forEach(device => {
                fetch(`http://${device.ip}:5000/data`)
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById(`cpu-${device.ip}`).innerText = data.cpu_usage + " %";
                        document.getElementById(`cpu-${device.ip}`).className = `status ${getStatusClass(data.cpu_usage, 50, 80)}`;

                        document.getElementById(`temp-${device.ip}`).innerText = data.temperature + " Â°C";
                        document.getElementById(`temp-${device.ip}`).className = `status ${getStatusClass(data.temperature, 60, 75)}`;

                        document.getElementById(`net-${device.ip}`).innerText = data.network_speed + " MB/s";
                    })
                    .catch(err => console.log(`Device ${device.ip} not responding`));
            });
        }

        function testNetworkSpeed(ip, peer) {
            const notification = document.getElementById(`network-status-${ip}`);
            notification.innerText = "Testing network speed...";

            fetch(`http://${ip}:5000/network_test`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ target_ip: peer })
            })
            .then(response => response.json())
            .then(data => {
                notification.innerText = data.message || data.error;
            })
            .catch(err => console.log(err));
        }

        function generateDeviceGrid() {
            const grid = document.getElementById("deviceGrid");
            grid.innerHTML = "";

            devices.forEach(device => {
                grid.innerHTML += `
                    <div class="device-card">
                        <h2>${device.name} (${device.ip})</h2>
                        <p>CPU Usage: <span id="cpu-${device.ip}" class="status">Loading...</span></p>
                        <p>Temperature: <span id="temp-${device.ip}" class="status">Loading...</span></p>
                        <p>Network Speed: <span id="net-${device.ip}" class="status">Loading...</span></p>
                        <button class="btn" onclick="testNetworkSpeed('${device.ip}', '${device.peer}')">Test Network Speed</button>
                        <p id="network-status-${device.ip}"></p>
                    </div>
                `;
            });
        }

        generateDeviceGrid();
        setInterval(updateStats, 2000);
    </script>
</body>
</html>
